#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

echo "Downloading databases"

BASE_URL="https://archive.statusgator.com/maxmind"

for i in ASN-CSV.zip City.tar.gz; do
  ( cd tmp && curl -s -O "$BASE_URL/GeoLite2-$i" )
done

echo "Extracting databases"

ENTRY=$( cd tmp && tar -ztpf GeoLite2-City.tar.gz | grep GeoLite2-City.mmdb )
( cd tmp && tar --strip-components 1 -xvpf GeoLite2-City.tar.gz $ENTRY )

ENTRY=$( cd tmp && unzip -l GeoLite2-ASN-CSV.zip  | grep csv | awk '{print $4}' )
echo $ENTRY
( cd tmp && unzip Geolite2-ASN-CSV.zip $ENTRY )
( cd tmp && cp $ENTRY . )

